name: Swift Tests

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  test:
    name: Build and Test
    runs-on: macos-13

    steps:
    - uses: actions/checkout@v3
    
    - name: Set up Xcode
      uses: maxim-lobanov/setup-xcode@v1
      with:
        xcode-version: '15.0'
    
    - name: List project files
      run: |
        find . -name "*.xcodeproj" -o -name "*.xcworkspace"
        
    - name: Show Xcode project structure
      run: |
        PROJECT_PATH=$(find . -name "*.xcodeproj" | head -n 1)
        if [ -n "$PROJECT_PATH" ]; then
          xcodebuild -list -project "$PROJECT_PATH"
        else
          echo "No Xcode project found"
        fi
      continue-on-error: true
      
    - name: Build and Test
      run: |
        PROJECT_PATH=$(find . -name "*.xcodeproj" | head -n 1)
        if [ -n "$PROJECT_PATH" ]; then
          xcodebuild test -project "$PROJECT_PATH" -scheme unpluggedCS -destination 'platform=iOS Simulator,name=iPhone 15,OS=17.0' -resultBundlePath TestResults.xcresult
        else
          echo "Using Swift Package Manager instead"
          swift test -v
        fi
